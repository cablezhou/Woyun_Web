# 高德地图双API密钥配置指南

## 问题说明

高德地图提供两种不同的API服务，需要使用不同的密钥：

1. **JS API** - 用于网页端交互式地图（在RouteDetail.vue中使用）
2. **Web服务API** - 用于静态地图生成、地理编码等服务（在缩略图生成中使用）

## 配置步骤

### 1. 获取两个API密钥

访问 [高德开放平台](https://lbs.amap.com/)：

1. **JS API密钥**：
   - 进入控制台 → 应用管理 → 我的应用
   - 创建应用，选择"Web端(JS API)"
   - 获取API Key

2. **Web服务API密钥**：
   - 同样在应用管理中
   - 创建应用，选择"Web服务API"
   - 获取API Key

### 2. 配置 .env.local 文件

```env
# 高德地图JS API（用于交互式地图）
VITE_AMAP_KEY=你的JS_API密钥
VITE_AMAP_SECRET=你的JS_API安全密钥

# 高德地图Web服务API（用于静态地图生成）
VITE_AMAP_WEB_KEY=你的Web服务API密钥

# 本地API地址
VITE_API_BASE_URL=http://localhost:3000/api
```

### 3. 服务配置对照表

| 功能 | 使用的API | 环境变量 | 用途 |
|------|-----------|----------|------|
| 路线详情页地图 | JS API | VITE_AMAP_KEY | 交互式地图显示 |
| 路线缩略图生成 | Web服务API | VITE_AMAP_WEB_KEY | 静态地图图片 |

### 4. 域名白名单配置

**JS API**：
- 开发环境：`localhost:5173`
- 生产环境：你的域名

**Web服务API**：
- 不需要域名限制（服务端调用）

### 5. 验证配置

配置完成后：

1. 重启开发服务器：`npm run dev`
2. 访问路线页面，检查控制台
3. 成功配置的话，会看到：
   - 路线详情页地图正常显示
   - 路线列表页缩略图自动生成

### 6. 常见错误

| 错误码 | 含义 | 解决方案 |
|--------|------|----------|
| 10009 | USERKEY_PLAT_NOMATCH | API密钥与平台不匹配，检查是否用错了密钥 |
| 10001 | INVALID_USER_KEY | 密钥无效，检查是否正确复制 |
| 10012 | INSUFFICIENT_PRIVILEGES | 服务未开通，在控制台开通对应服务 |

## 注意事项

1. **安全性**：
   - Web服务API密钥相对更敏感，建议定期更换
   - 生产环境建议使用IP白名单限制

2. **配额限制**：
   - 免费版本有调用次数限制
   - 静态地图API一般调用次数较少

3. **缓存机制**：
   - 项目已实现缓存，避免重复生成
   - 可以减少API调用次数

## 故障排除

如果仍然出现问题：

1. 检查控制台详细错误信息
2. 确认两个密钥都已正确配置
3. 验证密钥在高德控制台中是否有效
4. 检查服务是否已开通并有足够配额